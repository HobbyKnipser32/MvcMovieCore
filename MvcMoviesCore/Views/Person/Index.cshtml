@model IEnumerable<MvcMoviesCore.Models.Person>

@{
    var headline = "Personen";
    ViewData["Title"] = "Personen";
    if (ViewData["FilterFor"] != null && !string.IsNullOrEmpty(ViewData["FilterFor"].ToString()))
    {
        headline += ViewData["FilterFor"].ToString();
    }
    var originalFileDirectory = ViewData["OriginalFileDirectory"].ToString();
}
<div class="container-fluid">
    <h2>@headline</h2>
    <p>
        <a asp-action="Create" title="Person hinzufügen">
            <i class="fa-regular fa-square-plus fa-beat fa-2xl" style="color: #63E6BE;  --fa-animation-duration: 2s;"></i>
        </a>
    </p>
    <hr />
    <table class="table" id="personIndex">
        <thead>
            <tr>
                <th style="width: 50px">&nbsp;</th>                         @*  0 *@
                <th>@Html.DisplayNameFor(model => model.Name)</th>          @*  1 *@
                <th>&nbsp;</th>                                             @*  2 *@
                <th>@Html.DisplayNameFor(model => model.Birthday)</th>      @*  3 *@
                <th>@Html.DisplayNameFor(model => model.Obit)</th>          @*  4 *@
                <th>@Html.DisplayNameFor(model => model.Nationality)</th>   @*  5 *@
                <th>@Html.DisplayNameFor(model => model.Height)</th>        @*  6 *@
                <th>@Html.DisplayNameFor(model => model.Weight)</th>        @*  7 *@
                <th>&nbsp;</th>                                             @*  8 *@
                <th>@Html.DisplayNameFor(model => model.PersonType)</th>    @*  9 *@
                <th>@Html.DisplayNameFor(model => model.Sex)</th>           @* 10 *@
                <th>&nbsp;</th>                                             @* 11 *@
                <th>&nbsp;</th>                                             @* 12 *@
            </tr>
        </thead>
        @* <tbody>
        @foreach (var item in Model)
        {
        var imgSrc = originalFileDirectory + "/" + @item.Image;
        <tr>
        <td>
        @if (!string.IsNullOrEmpty(item.Image))
        {
        <div class="image-container">
        <img src="@imgSrc" title="@item.Name" class="image-small" style="max-height: 50px" />
        <img src="@imgSrc" title="@item.Name" class="image-large" />
        </div>
        }
        else
        {
        <div class="image-container">
        <img src="~/images/noimageexists.png" class="image-small" style="max-height: 35px" />
        <img src="~/images/noimageexists.png" title="@item.Name" class="image-large" />
        </div>
        }
        </td>
        <td>
        <a asp-action="Details" asp-route-id="@item.Id">@Html.DisplayFor(modelItem => item.Name)</a>
        </td>
        <td>
        @Html.DisplayFor(modelItem => item.ActorsAge)
        </td>
        <td>
        @Html.DisplayFor(modelItem => item.Birthday)
        </td>
        <td>
        @Html.DisplayFor(modelItem => item.Obit)
        </td>
        <td>
        @Html.DisplayFor(modelItem => item.Nationality.Name)
        </td>
        <td>
        @Html.DisplayFor(modelItem => item.Height)
        </td>
        <td>
        @Html.DisplayFor(modelItem => item.Weight)
        </td>
        <td>
        @Html.DisplayFor(modelItem => item.Classification)
        </td>
        <td>
        @Html.DisplayFor(modelItem => item.PersonType.Name)
        </td>
        <td>
        @Html.DisplayFor(modelItem => item.Sex.Name)
        </td>
        <td>
        <a asp-action="Edit" asp-route-id="@item.Id">
        <i class="fa-solid fa-pen fa-bounce" style="color: #74C0FC; --fa-animation-duration: 2s;"></i>
        </a>
        </td>
        <td>
        <a asp-action="Delete" asp-route-id="@item.Id">
        <i class="fa-regular fa-trash-can fa-shake" style="color: #ff0000; --fa-animation-duration: 2s;"></i>
        </a>
        </td>
        </tr>
        }
        </tbody> *@
        <a href=""></a>
    </table>
</div>

@section Scripts
{
    <partial name="_DataTableScripts" />
    <partial name="_ShowImageModalScripts" />

    <script>
        $(document).ready(function () {
            $('#personIndex').DataTable({
                initComplete: function () {
                    this.api()
                        .columns()
                        .every(function () {
                            let column = this;
                            let title = column.header().textContent;

                            // Create input element
                            let input = document.createElement('input');
                            input.placeholder = title;
                            column.footer().replaceChildren(input);

                            // Event listener for user input
                            input.addEventListener('keyup', () => {
                                if (column.search() !== this.value) {
                                    column.search(input.value).draw();
                                }
                            });
                        });
                },
                ajax: {
                    url: appRootPath + '/api/PersonApi',
                    dataSrc: ''
                },
                columns:
                    [
                        {
                            data: 'Image',
                            render: function (data, type, full) {
                                if (type == 'display') {
                                    if (data) {
                                        let imgSrc = '@originalFileDirectory' + "/" + data;
                                        return '<div class="image-container" >'
                                            + '<img src="' + imgSrc + '" class="image-small" style = "max-height: 50px" />'
                                            + '<img src="' + imgSrc + '" class="image-large" />'
                                            + '</div>';
                                    }
                                    else {
                                        return '<div class="image-container" >'
                                            + '<img src="/images/noimageexists.png" class="image-small" style = "max-height: 35px" />'
                                            + '<img src="/images/noimageexists.png" class="image-large" />'
                                            + '</div>';
                                    }
                                }
                                return '';
                            },
                            type: 'html'
                        },
                        {
                            data: 'Id',
                            render: function (data, type, full) {
                                if (type == 'display' && data) {
                                    let link = '@Url.Action("Details", "Person")' + '/' + data;
                                    return '<a href="' + link + '" >' + full["Name"];
                                    // return '<a asp-action="Details" asp-route-id="' + full["Id"] + '" >' + data + '</a>';
                                }
                                return '';
                            },
                            type: 'html'
                        },
                        {
                            data: 'ActorsAge',
                            type: 'html-num'
                        },
                        {
                            data: 'Birthday',
                            render: function (data, type, full) {
                                if (type = 'display' && data) {
                                    moment.locale('de');
                                    return moment(data).format('ll');
                                }
                                return '';
                            },
                            type: 'date'
                        },
                        {
                            data: 'Obit',
                            render: function (data, type, full) {
                                if (type = 'display' && data) {
                                    moment.locale('de');
                                    return moment(data).format('ll');
                                }
                                return '';
                            }, 
                            type: 'date'
                        },
                        {
                            data: 'Nationality.Name',
                            type: 'html'
                        },
                        {
                            data: 'Height',
                            type: 'html-num'
                        },
                        {
                            data: 'Weight',
                            type: 'html-num'
                        },
                        {
                            data: 'Classification',
                            type: 'html-num'
                        },
                        {
                            data: 'PersonType.Name',
                            type: 'html'
                        },
                        {
                            data: 'Sex.Name',
                            type: 'html'
                        },
                        {
                            data: 'Id',
                            render: function (data, type, full) {
                                if (type == 'display') {
                                    return '<a asp-action="Edit" asp-route-id="' + data + '" >'
                                        + '<i class="fa-solid fa-pen fa-bounce" style = "color: #74C0FC; --fa-animation-duration: 2s;" > </i>';
                                    // + '< /a>';
                                }
                                return '';
                            }
                        },
                        {
                            data: 'Id',
                            render: function (data, type, full) {
                                if (type == 'display') {
                                    return '<a asp-action="Delete" asp-route-id="' + data + '">'
                                        + '<i class="fa-regular fa-trash-can fa-shake" style = "color: #ff0000; --fa-animation-duration: 2s;" ></i>';
                                    // + '< /a>'
                                }
                                return '';
                            }
                        },
                    ],
                ordering: true,
                order: [[1, 'asc']],
                lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                iDisplayLength: 10,
                fixedHeader: {
                    header: true,
                    footer: false
                },
                columnDefs: [{
                    orderable: false,
                    targets: [0, 10, 11]
                }],
                searchHighlight: true,

            });

            $('#personIndex tbody').on('mouseenter', '.image-container', function () {
                onMouseEnter(this);
            });

            $('#personIndex tbody').on('mouseleave', '.image-container', function () {
                onMouseLeave(this);
            });

        })
    </script>
}